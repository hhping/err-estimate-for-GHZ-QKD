clc;
clear all;
format long;
% 
% N_leak = 120332;
% Nv = 35981;
% Nu = 1000000;
% N0 = 35;
% Mv = 495;
% M0 = 17;

% para_matric0  = {1000000,35981.461353366 ,35.7850480897444,495.596356554888,17.892524044755 ,120332.536369305};
% para_matric3  = {1000000,35961.7085506858,71.1759552928334,529.8280054229  ,35.5879776461836,122008.402964697};
% para_matric7  = {1000000,36081.2869868901,178.246389934254,635.687607210491,89.1231949665436,127038.461281708};
% para_matric10 = {1000000,36337.2685806179,354.640248269825,810.841903170854,177.320124133751,135200.10549175 };
% para_matric13 = {1000000,36866.3745782412,704.180382337641,1158.20558698842,352.090191166514,150951.754933653};
% para_matric17 = {1000000,38458.5128252339,1744.39653438422,2192.16933554125,872.198267186397,195069.522815495};
% para_matric20 = {1000000,41003.6201250481,3403.53309584036,3841.40582833352,1701.76654790903,258973.533234057};

 %           nleak         nu1-nu   nu2--nv          nu3-no           mu2-mv              mu3-mo
% para = floor(
%        [120332.536369305 1000000 35981.461353366  35.7850480897444 495.596356554888 17.892524044755 ;       % 120332.536369305;
%         122008.402964697 1000000 35961.7085506858 71.1759552928334 529.8280054229   35.5879776461836;       % 122008.402964697;
%         127038.461281708 1000000 36081.2869868901 178.246389934254 635.687607210491 89.1231949665436;       % 127038.461281708;
%         135200.10549175  1000000 36337.2685806179 354.640248269825 810.841903170854 177.320124133751;       % 135200.10549175 ;
%         150951.754933653 1000000 36866.3745782412 704.180382337641 1158.20558698842 352.090191166514;       % 150951.754933653;
%         195069.522815495 1000000 38458.5128252339 1744.39653438422 2192.16933554125 872.198267186397;       % 195069.522815495;
%         258973.533234057 1000000 41003.6201250481 3403.53309584036 3841.40582833352 1701.76654790903]);     % 258973.533234057];
% 
% para = [120332 1000000 35981 35   495  17  ;      % 120332.536369305;
%         122008 1000000 35961 71   529  35  ;       % 122008.402964697;
%         127038 1000000 36081 178  635  89  ;       % 127038.461281708;
%         135200 1000000 36337 354  810  177 ;        % 135200.10549175 ;
%         150951 1000000 36866 704  1158 352 ;       % 150951.754933653;
%         195069 1000000 38458 1744 2192 872 ;       % 195069.522815495;
%         258973 1000000 41003 3403 3841 1701; ];      % 258973.533234057];

% para = [0 199850 4350 590   529  293  ; ] ;     % 120332.536369305;
%para = [120332 1000000 35981 35   495  17  ; ] ;     % 120332.536369305;
% para = [122008 1000000 35961 71   529  35  ; ];      % 122008.402964697;
% para = [127038 1000000 36081 178  635  89  ; ];      % 127038.461281708;
% para = [135200 1000000 36337 354  810  177; ];       % 135200.10549175 ;
% para = [150951 1000000 36866 704  1158 352 ; ];      % 150951.754933653;
% para = [195069 1000000 38458 1744 2192 872 ; ];      % 195069.522815495;
% para = [258973 1000000 41003 3403 3841 1701; ];      % 258973.533234057];
% para = [ 1000000 1000000 100000 10000 10000 10000;];
% para = [ 25897300 1000000 4100300 340300 384100 170100;];
%         1000000 10000000 1000000 1000000 1000000 1000000;];
% para = [0 199850 12042 1636   1696  803  ; ] ; 
para = [573750 1036800 62445 9265 9325 4678;];
     

fid = fopen('E:\QKD_1GHZ\chu_engineer\pa_len_est1\result.txt','r+');
fprintf(fid,'#####################  simulation is begin ###########################\n\n\n');

 for i = 1 : 1
    fprintf(fid,'第  %d   组数据仿真结果如下：\n', i);
%     fprintf(fid,'第  %d   组数据输入参数如下：nleak = %1.10f, nu1 = %1.10f,nu2 = %1.10f,nu3 = %1.10f,nu4 = %1.10f,nu5 = %1.10f,\n', i,para(i,1),para(i,2),para(i,3),para(i,4),para(i,5),para(i,6));

    len_float = vpa(pa_len_est_float(para(i,1),para(i,2),para(i,3),para(i,4),para(i,5),para(i,6),fid),10)
  

    len_fix = vpa(pa_len_est_fix(para(i,1),para(i,2),para(i,3),para(i,4),para(i,5),para(i,6),fid),10)


    abs(len_float - len_fix)
    
    fprintf(fid,'\n');
    fprintf(fid,'浮点仿真结果： %1.10f \n',double(len_float));
    fprintf(fid,'定点仿真结果： %1.10f \n',double(len_fix));
    fprintf(fid,'仿真结果之差 ：len_float - len_fix = %1.10f \n\n\n\n\n',double(abs(len_float - len_fix)));
 end
fprintf(fid,'##################### simulation is end ###########################\n\n\n');
fclose(fid);
% len_float = vpa(pa_len_est_float(N_leak,Nv,Nu,N0,Mv,M0),10)

% len_fix = vpa(pa_len_est_fix(N_leak,Nv,Nu,N0,Mv,M0),10)

% abs(len_float - len_fix)